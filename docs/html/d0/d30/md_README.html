<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Controllers for force manipulation of a mobile robot: force_manipulation &lt;img src=&quot;https://img.shields.io/github/issues/Heile28/force_manipulation&quot; alt=&quot;alt text&quot;/&gt; &lt;img src=&quot;https://img.shields.io/github/forks/Heile28/force_manipulation&quot; alt=&quot;alt text&quot;/&gt;</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Controllers for force manipulation of a mobile robot
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d0/d30/md_README.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">force_manipulation <img src="https://img.shields.io/github/issues/Heile28/force_manipulation" alt="alt text" class="inline"/> <img src="https://img.shields.io/github/forks/Heile28/force_manipulation" alt="alt text" class="inline"/> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This repository can be used to implement a controlling mechanism for driving the mobile robot MuR205 consisting of UR5 manipulator and MiR plattform by external forces. It is intended for gazebo simulation inside ROS.</p>
<h1>Prerequisites</h1>
<p>The following instructions assume that a Catkin workspace has been created. Browse in </p><div class="fragment"><div class="line">cd $HOME/catkin_ws/src</div>
</div><!-- fragment --><h2>Clone the following repositories</h2>
<ul>
<li><a href="https://github.com/Heile28/force_manipulation.git">force_manipulation</a></li>
<li><a href="https://github.com/ros-industrial/universal_robot">universal_robot</a></li>
<li><a href="https://github.com/matchRos/MiR200_Sim">MiR200_Sim</a></li>
<li><a href="https://github.com/Heile28/MiR200-with-UR5">MiR200-with-UR5</a></li>
<li><a href="https://github.com/pal-robotics/gazebo_ros_link_attacher">gazebo_ros_link_attacher</a></li>
<li><a href="https://github.com/fzi-forschungszentrum-informatik/cartesian_controllers">cartesian_controllers</a> <div class="fragment"><div class="line">git clone https://github.com/Heile28/force_manipulation.git</div>
<div class="line">git clone -b $melodic-devel https://github.com/ros-industrial/universal_robot.git</div>
<div class="line">git clone https://github.com/matchRos/MiR200_Sim.git</div>
<div class="line">git clone https://github.com/Heile28/MiR200-with-UR5.git</div>
<div class="line">git clone -b $melodic-devel https://github.com/pal-robotics/gazebo_ros_link_attacher</div>
<div class="line">git clone https://github.com/matchRos/MiR200_Sim.git</div>
</div><!-- fragment --> into your catkin workspace.</li>
</ul>
<h2>Dependencies</h2>
<div class="fragment"><div class="line">cd ~/MiR200_Sim/mir_driver/nodes/</div>
<div class="line">chmod +x rep117_filter.py</div>
<div class="line">cd $HOME/catkin_ws</div>
<div class="line"> </div>
<div class="line"># Install </div>
<div class="line">sudo apt-get install ros-melodic-moveit</div>
<div class="line">sudo apt-get install ros-melodic-moveit-visual-tools</div>
<div class="line">sudo apt install ros-melodic-cob-gazebo-ros-control</div>
<div class="line">sudo apt-get install ros-melodic-plotjuggler</div>
<div class="line">sudo apt-get install ros-melodic-joint-trajectory-controller</div>
<div class="line">sudo apt-get install ros-melodic-dwa-local-planner</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"># checking dependencies</div>
<div class="line">sudo apt-get update -qq</div>
<div class="line">sudo apt-get install -qq -y python-rosdep</div>
<div class="line">sudo rosdep init (or sudo rm /etc/ros/rosdep/sources.list.d/20-default.list)</div>
<div class="line">sudo rosdep update or sudo apt update + ~ upgrade</div>
<div class="line">sudo rosdep install --from-paths ./ -i -y --rosdistro melodic</div>
<div class="line"> </div>
<div class="line">catkin_make</div>
<div class="line"> </div>
<div class="line"># activate this workspace via ~/.bashrc</div>
<div class="line">source $HOME/catkin_ws/devel/setup.bash</div>
</div><!-- fragment --> <h1>Getting Started</h1>
<h2>Preamble</h2>
<h3>Main Control Loop</h3>
<p>The mobile robot is driven by two separated systems of MiR and UR5. As the movement - in observance of non-holomic constraints - is controlled by the well-known diff_drive_controller, the UR5 reacts compliant to any force attack. The main controller connects both systems by interchanging relative motions. The current version reduces the linear velocity to 0.233 m/s in advance whereas the compliance controller absorbs the force intensity. <img src="https://github.com/Heile28/force_manipulation/blob/master/etc/main_control.png" alt="Image of Main_Control" class="inline"/></p>
<h3>FDCC-Solver</h3>
<p>The Cartesian Compliance controller is a merging of impedance, admittance and force control visibly as following: <img src="https://github.com/Heile28/force_manipulation/blob/master/etc/FDCC_model.PNG" alt="Image of FDCC_Control" class="inline"/></p>
<p>Information about the implemented control loop used for the Forward Dynamics Solver provides <a href="https://arxiv.org/pdf/1908.06252.pdf">this paper</a>.</p>
<h2>Configurations</h2>
<h3>Configure the cartesian compliance controller</h3>
<h4>Write a yaml.-file with the following entries saved as 'cartesian_compliance_controller.yaml'</h4>
<div class="fragment"><div class="line">arm_cartesian_compliance_controller:</div>
<div class="line">  type: &quot;position_controllers/CartesianComplianceController&quot;</div>
<div class="line">  end_effector_link: &quot;$(arg tf_prefix)ee_link_ur5&quot;    # All links below must come before this link</div>
<div class="line">  robot_base_link: &quot;$(arg tf_prefix)base_link_ur5&quot;</div>
<div class="line">  ft_sensor_ref_link: &quot;$(arg tf_prefix)wrist_3_link_ur5&quot;</div>
<div class="line">  compliance_ref_link: &quot;$(arg tf_prefix)ee_link_ur5&quot;</div>
<div class="line">  target_frame_topic: &quot;target_pose&quot; #target_frame</div>
<div class="line">  joints:</div>
<div class="line">    - $(arg tf_prefix)shoulder_pan_joint</div>
<div class="line">    - $(arg tf_prefix)shoulder_lift_joint</div>
<div class="line">    - $(arg tf_prefix)elbow_joint</div>
<div class="line">    - $(arg tf_prefix)wrist_1_joint</div>
<div class="line">    - $(arg tf_prefix)wrist_2_joint</div>
<div class="line">    - $(arg tf_prefix)wrist_3_joint</div>
<div class="line"> </div>
<div class="line">  stiffness:</div>
<div class="line">      trans_x: 200</div>
<div class="line">      trans_y: 200</div>
<div class="line">      trans_z: 200</div>
<div class="line">      rot_x: 150</div>
<div class="line">      rot_y: 150</div>
<div class="line">      rot_z: 150</div>
<div class="line"> </div>
<div class="line">  pd_gains:</div>
<div class="line">      trans_x: {p: 0.05}</div>
<div class="line">      trans_y: {p: 0.05}</div>
<div class="line">      trans_z: {p: 0.05}</div>
<div class="line">      rot_x: {p: 0.01}</div>
<div class="line">      rot_y: {p: 0.01}</div>
<div class="line">      rot_z: {p: 0.01}</div>
</div><!-- fragment --><p> and store it in ~/MiR200-with-UR5/mir_ur5_description/config </p><h4>Get this configuration launched as ROS controller with Gazebo</h4>
<ul>
<li>Browse into MiR200-with-UR5/mir_ur5/launch/mir_ur5.launch and include cartesian controller as argument <div class="fragment"><div class="line">&lt;arg name=&quot;active_controllers&quot; default=&quot;arm_cartesian_compliance_controller&quot;/&gt;</div>
</div><!-- fragment --></li>
<li>and load controller configuration from YAML file by <div class="fragment"><div class="line">&lt;rosparam file=&quot;$(find mir_ur5_description)/config/cartesian_compliance_controller.yaml&quot; command=&quot;load&quot; subst_value=&quot;true&quot;/&gt;</div>
</div><!-- fragment --></li>
<li>Spawn the controller (besides joint_state_controller) by <div class="fragment"><div class="line">&lt;!-- spawn controller manager with all active controllers (args are all namespaces from inside controller_configurations files--&gt;</div>
<div class="line">&lt;node name=&quot;controller_spawner&quot; pkg=&quot;controller_manager&quot; type=&quot;spawner&quot; respawn=&quot;false&quot; output=&quot;screen&quot; ns=&quot;/$(arg robot_namespace)&quot;</div>
<div class="line">            args=&quot;$(arg active_controllers)&quot;&gt;</div>
<div class="line">            </div>
<div class="line">&lt;!-- Robot state publisher that publishes the current state of the robot to tf --&gt;</div>
<div class="line">      &lt;node pkg=&quot;robot_state_publisher&quot; type=&quot;robot_state_publisher&quot; name=&quot;robot_state_publisher&quot; output=&quot;screen&quot;/&gt;</div>
<div class="line"> &lt;/node&gt;</div>
</div><!-- fragment --> <h3>Add Gazebo Force Torque Sensor</h3>
</li>
</ul>
<h4>Create a configuration file for the F/T-plugin saved as 'force_sensor.gazebo.xacro'</h4>
<div class="fragment"><div class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</div>
<div class="line">&lt;robot xmlns:xacro=&quot;http://wiki.ros.org/wiki/xacro&quot;&gt; </div>
<div class="line">  &lt;xacro:macro name=&quot;sensor_force_torque&quot; params=&quot;joint_name topic_name&quot;&gt;</div>
<div class="line">    &lt;gazebo reference=&quot;${joint_name}&quot;&gt;</div>
<div class="line">     &lt;provideFeedback&gt;true&lt;/provideFeedback&gt;</div>
<div class="line">     &lt;!-- &lt;turnGravityOff&gt;false&lt;/turnGravityOff&gt; --&gt;</div>
<div class="line">     &lt;visualize&gt;true&lt;/visualize&gt;</div>
<div class="line">    &lt;/gazebo&gt;</div>
<div class="line">    &lt;gazebo&gt;</div>
<div class="line">     &lt;plugin name=&quot;ft_sensor&quot; filename=&quot;libgazebo_ros_ft_sensor.so&quot;&gt;</div>
<div class="line">       &lt;alwaysOn&gt;true&lt;/alwaysOn&gt;</div>
<div class="line">       &lt;updateRate&gt;100.0&lt;/updateRate&gt;</div>
<div class="line">       &lt;topicName&gt;${topic_name}&lt;/topicName&gt;</div>
<div class="line">       &lt;jointName&gt;${joint_name}&lt;/jointName&gt;</div>
<div class="line">       &lt;!--&lt;gaussianNoise&gt;0.0&lt;/gaussianNoise&gt;--&gt;</div>
<div class="line">     &lt;/plugin&gt;</div>
<div class="line">    &lt;/gazebo&gt;</div>
<div class="line">  &lt;/xacro:macro&gt;</div>
<div class="line">&lt;/robot&gt;</div>
</div><!-- fragment --><ul>
<li>and store it in ~/MiR200-with-UR5/mir_ur5_desription/urdf/include</li>
<li>Browse into MiR200-with-UR5/mir_ur5_desription/urdf/mir_ur5.urdf.xacro and add <div class="fragment"><div class="line">&lt;!--add force_torque sensor--&gt;</div>
<div class="line">&lt;xacro:include filename=&quot;$(find mir_ur5_description)/urdf/include/force_sensor.gazebo.xacro&quot; /&gt;</div>
<div class="line">&lt;xacro:sensor_force_torque joint_name=&quot;$(arg tf_prefix)wrist_3_joint&quot; topic_name=&quot;ee_force_torque_sensor&quot;/&gt;</div>
</div><!-- fragment --> <h3>Configure UR Kinematics Package</h3>
</li>
</ul>
<p>The <a href="https://github.com/ros-industrial/universal_robot">universal_robot</a> -package provides the repo namely "[ur_kinematics](https://github.com/ros-industrial/universal_robot/tree/kinetic-devel/ur_kinematics)".</p><ul>
<li>Adapt its file <a href="https://github.com/ros-industrial/universal_robot/blob/kinetic-devel/ur_kinematics/src/ur_kin.cpp">ur_kin.cpp</a> by uncommenting line 16-26: <div class="fragment"><div class="line">/*</div>
<div class="line">    #define UR10_PARAMS</div>
<div class="line">    #ifdef UR10_PARAMS</div>
<div class="line">    const double d1 =  0.1273;</div>
<div class="line">    const double a2 = -0.612;</div>
<div class="line">    const double a3 = -0.5723;</div>
<div class="line">    const double d4 =  0.163941;</div>
<div class="line">    const double d5 =  0.1157;</div>
<div class="line">    const double d6 =  0.0922;</div>
<div class="line">    #endif</div>
<div class="line">    </div>
<div class="line">    #define UR5_PARAMS</div>
<div class="line">    #ifdef UR5_PARAMS</div>
<div class="line">*/</div>
</div><!-- fragment --></li>
<li>and line 34-44: <div class="fragment"><div class="line">/*</div>
<div class="line">    #endif</div>
<div class="line">    </div>
<div class="line">    #define UR3_PARAMS</div>
<div class="line">    #ifdef UR3_PARAMS</div>
<div class="line">    const double d1 =  0.1519;</div>
<div class="line">    const double a2 = -0.24365;</div>
<div class="line">    const double a3 = -0.21325;</div>
<div class="line">    const double d4 =  0.11235;</div>
<div class="line">    const double d5 =  0.08535;</div>
<div class="line">    const double d6 =  0.0819;</div>
<div class="line">    #endif</div>
<div class="line">*/</div>
</div><!-- fragment --></li>
<li>Again execute <div class="fragment"><div class="line">catkin_make</div>
</div><!-- fragment --> <h2>Start simulation</h2>
</li>
</ul>
<div class="fragment"><div class="line">roslaunch mir_ur5 system_sim.launch</div>
</div><!-- fragment --> <h3>Feature</h3>
<div class="fragment"><div class="line">sudo apt-get install ros-melodic-rqt-joint-trajectory-controller</div>
<div class="line">rosrun rqt_joint_trajectory_controller rqt_joint_trajectory_controller</div>
</div><!-- fragment --><p> &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p>
<hr  />
 <blockquote class="doxtable">
<blockquote class="doxtable">
<blockquote class="doxtable">
<blockquote class="doxtable">
<blockquote class="doxtable">
<blockquote class="doxtable">
<blockquote class="doxtable">
<p>470b812138ae82862b14ecf2f5abc8f1a818ad72 </p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.0 </li>
  </ul>
</div>
</body>
</html>
